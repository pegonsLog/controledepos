<mat-card class="po-list-card">
  <mat-card-content>
    <div class="header-grid" style="margin-bottom: 0px;">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Filtrar POs</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Ex. PO-001, João Silva" #filterInput>
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <div class="action-buttons-group" style="padding-bottom: 18px;">
        <button mat-raised-button (click)="navegarParaNovoPo()" class="action-button">
          <mat-icon>add</mat-icon>
          Adicionar PO
        </button>
      </div>
    </div>

    <div class="table-container">
      <!-- Indicador de Carregamento -->
      <div *ngIf="isLoading" style="display: flex; justify-content: center; align-items: center; padding: 20px;">
        <mat-spinner diameter="50"></mat-spinner>
      </div>

      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8" *ngIf="!isLoading">

        <!-- Coluna Número do PO -->
        <ng-container matColumnDef="numero_po">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Nº do PO </th>
          <td mat-cell *matCellDef="let po"> {{po.numero_po}} </td>
        </ng-container>

        <!-- Coluna Data do PO -->
        <ng-container matColumnDef="data_po">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Data PO </th>
          <td mat-cell *matCellDef="let po"> {{po.data_po | date:'dd/MM/yyyy'}} </td>
        </ng-container>

        <!-- Coluna Tipo de Logradouro -->
        <ng-container matColumnDef="tipo_de_logradouro">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo Logradouro </th>
          <td mat-cell *matCellDef="let po"> {{po.tipo_de_logradouro}} </td>
        </ng-container>

        <!-- Coluna Logradouro -->
        <ng-container matColumnDef="logradouro">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Logradouro </th>
          <td mat-cell *matCellDef="let po"> {{po.logradouro}} </td>
        </ng-container>

        <!-- Coluna Complemento do Logradouro -->
        <ng-container matColumnDef="complemento">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Complemento </th>
          <td mat-cell *matCellDef="let po"> {{po.complemento}} </td>
        </ng-container>

        <!-- Coluna Analista -->
        <ng-container matColumnDef="analista">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Analista </th>
          <td mat-cell *matCellDef="let po"> {{po.analista}} </td>
        </ng-container>

        <!-- Coluna Data de Implantação -->
        <ng-container matColumnDef="data_implantacao">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Data Implantação </th>
          <td mat-cell *matCellDef="let po"> {{po.data_implantacao | date:'dd/MM/yyyy'}} </td>
        </ng-container>

        <!-- Coluna Funcionário Responsável -->
        <ng-container matColumnDef="funcionario_responsavel">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Funcionário Resp. </th>
          <td mat-cell *matCellDef="let po"> {{po.funcionario_responsavel}} </td>
        </ng-container>

        <!-- Coluna Bairro -->
        <ng-container matColumnDef="bairro">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Bairro </th>
          <td mat-cell *matCellDef="let po"> {{po.bairro}} </td>
        </ng-container>

        <!-- Coluna Observações -->
        <ng-container matColumnDef="observacoes">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Observações </th>
          <td mat-cell *matCellDef="let po"> {{po.observacoes}} </td>
        </ng-container>

        <!-- Coluna Detalhamento -->
        <ng-container matColumnDef="detalhamento">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Detalhamento </th>
          <td mat-cell *matCellDef="let po"> {{po.detalhamento}} </td>
        </ng-container>

        <!-- Coluna Especificações -->
        <ng-container matColumnDef="especificacoes">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Especificações </th>
          <td mat-cell *matCellDef="let po"> {{po.especificacoes}} </td>
        </ng-container>

        <!-- Coluna E-mail -->
        <ng-container matColumnDef="e_mail">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> E-mail </th>
          <td mat-cell *matCellDef="let po"> {{po.e_mail}} </td>
        </ng-container>

        <!-- Coluna Situação -->
        <ng-container matColumnDef="situacao">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Situação </th>
          <td mat-cell *matCellDef="let po"> {{po.situacao}} </td>
        </ng-container>

        <!-- Coluna Solicitante -->
        <ng-container matColumnDef="solicitante">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Solicitante </th>
          <td mat-cell *matCellDef="let po"> {{po.solicitante}} </td>
        </ng-container>

        <!-- Coluna Tipo de Solicitante -->
        <ng-container matColumnDef="tipo_de_solicitante">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo Solicitante </th>
          <td mat-cell *matCellDef="let po"> {{po.tipo_de_solicitante}} </td>
        </ng-container>

        <!-- Coluna Data de Encerramento DRO -->
        <ng-container matColumnDef="data_enc_dro">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Data Enc. DRO </th>
          <td mat-cell *matCellDef="let po"> {{po.data_enc_dro | date:'dd/MM/yyyy'}} </td>
        </ng-container>

        <!-- Coluna Link do PO -->
        <ng-container matColumnDef="link_do_po">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Link PO </th>
          <td mat-cell *matCellDef="let po"><a [href]="po.link_do_po" target="_blank">Link</a></td>
        </ng-container>

        <!-- Coluna Número de Controle -->
        <ng-container matColumnDef="numero_de_controle">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Nº Controle </th>
          <td mat-cell *matCellDef="let po"> {{po.numero_de_controle}} </td>
        </ng-container>

        <!-- Coluna Data de Arquivamento -->
        <ng-container matColumnDef="data_arquivamento">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Data Arquivamento </th>
          <td mat-cell *matCellDef="let po"> {{po.data_arquivamento | date:'dd/MM/yyyy'}} </td>
        </ng-container>

        <!-- Coluna Criado Em -->
        <ng-container matColumnDef="criado_em">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Criado Em </th>
          <td mat-cell *matCellDef="let po"> {{po.criado_em | date:'dd/MM/yyyy'}} </td>
        </ng-container>

        <!-- Coluna Última Edição -->
        <ng-container matColumnDef="ultima_edicao">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Última Edição </th>
          <td mat-cell *matCellDef="let po"> {{po.ultima_edicao | date:'dd/MM/yyyy'}} </td>
        </ng-container>

        <!-- Coluna Ações -->
        <ng-container matColumnDef="acoes">
          <th mat-header-cell *matHeaderCellDef> Ações </th>
          <td mat-cell *matCellDef="let po">
            <button mat-icon-button class="action-button-details" (click)="detalhesPo(po.numero_po)" matTooltip="Detalhes PO">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button class="action-button-edit" (click)="editarPo(po.numero_po)" matTooltip="Editar PO">
              <mat-icon>edit</mat-icon> 
            </button>
            <button mat-icon-button class="action-button-delete" (click)="excluirPo(po.numero_po)" matTooltip="Excluir PO">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="displayedColumns.length">
            <span *ngIf="!filterInput.value">Nenhum PO encontrado.</span>
            <span *ngIf="filterInput.value">Nenhum dado encontrado para o filtro "{{filterInput.value}}"</span>
          </td>
        </tr>
      </table>
    </div>

    <!-- Controles de Paginação Manual -->
    <div class="manual-pagination-controls" *ngIf="!isLoading && dataSource.data.length > 0" 
         style="display: flex; justify-content: center; align-items: center; padding: 20px;">
      <button mat-raised-button 
              (click)="previousPage()" 
              [disabled]="isFirstPage || isLoading" 
              aria-label="Página anterior"
              style="margin-right: 8px;">
        <mat-icon>keyboard_arrow_left</mat-icon>
        Anterior
      </button>
      <button mat-raised-button 
              (click)="nextPage()" 
              [disabled]="isLastPage || isLoading" 
              aria-label="Próxima página">
        Próxima
        <mat-icon>keyboard_arrow_right</mat-icon>
      </button>
    </div>

    <!-- Mensagem se não houver dados na primeira carga e não estiver carregando -->
    <div *ngIf="!isLoading && dataSource.data.length === 0 && isFirstPage" 
         style="display: flex; justify-content: center; align-items: center; padding: 20px; color: grey;">
      Nenhum PO encontrado para exibir.
    </div>

  </mat-card-content>
</mat-card>